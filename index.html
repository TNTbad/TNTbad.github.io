<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продуктивный менеджер PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f8f0 0%, #e0f0e0 100%);
            color: #2d4a2d;
            line-height: 1.6;
            min-height: 100vh;
            padding: 15px;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* Шапка */
        .app-header {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            padding: 1.2rem 1.5rem;
            text-align: center;
            border-bottom: 3px solid #81c784;
            position: relative;
        }

        .app-header h1 {
            margin-bottom: 0.8rem;
            font-size: 1.8rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .user-section {
            position: absolute;
            right: 20px;
            top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        .app-header nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .nav-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
            min-width: 80px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Основной контент */
        .app-main {
            padding: 1.5rem;
            min-height: 500px;
        }

        .module-container {
            max-width: 1000px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .module-title {
            font-size: 1.6rem;
            margin-bottom: 1.2rem;
            color: #2e7d32;
            text-align: center;
            border-bottom: 2px solid #c8e6c9;
            padding-bottom: 0.5rem;
            font-weight: 600;
        }

        /* Стили для компонента задач */
        .add-task-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: #f1f8e9;
            padding: 18px;
            border-radius: 15px;
            border: 1px solid #c5e1a5;
        }

        .add-task-form input,
        .add-task-form select,
        .add-task-form textarea {
            padding: 12px 15px;
            border: 2px solid #a5d6a7;
            border-radius: 10px;
            flex-grow: 1;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            color: #33691e;
        }

        .add-task-form input:focus,
        .add-task-form select:focus,
        .add-task-form textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .add-task-form button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.3);
        }

        .add-task-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .task-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 8px 16px;
            background: #e8f5e9;
            border: 2px solid #c8e6c9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            color: #388e3c;
            font-weight: 500;
        }

        .filter-btn.active {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.3);
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            background: #f1f8e9;
            transition: all 0.3s;
            border-left: 4px solid #66bb6a;
            border: 1px solid #c5e1a5;
            position: relative;
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.15);
        }

        .task-item.completed {
            opacity: 0.8;
            border-left-color: #81c784;
            background: #e8f5e9;
        }

        .task-checkbox {
            margin-right: 15px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #4caf50;
        }

        .task-content {
            flex-grow: 1;
        }

        .task-text {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #2e7d32;
            font-weight: 500;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #689f38;
        }

        .task-meta {
            display: flex;
            gap: 10px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .task-tag {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .tag-work { background: #ffebee; color: #c62828; }
        .tag-personal { background: #e8f5e9; color: #2e7d32; }
        .tag-health { background: #e3f2fd; color: #1565c0; }
        .tag-learning { background: #fff8e1; color: #f57f17; }

        .task-priority {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .priority-high { background: #ffebee; color: #c62828; }
        .priority-medium { background: #fff8e1; color: #f57f17; }
        .priority-low { background: #e8f5e9; color: #2e7d32; }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-delete {
            background: #ffebee;
            color: #c62828;
        }

        .btn-delete:hover {
            background: #ffcdd2;
        }

        .btn-comment {
            background: #e3f2fd;
            color: #1565c0;
        }

        .btn-comment:hover {
            background: #bbdefb;
        }

        .task-comments {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #c8e6c9;
        }

        .comment {
            padding: 8px;
            margin-bottom: 5px;
            background: #f9f9f9;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        /* Стили для Продуктивного таймера */
        .timer-container {
            text-align: center;
            padding: 1.5rem;
        }

        .timer-display {
            font-size: 3.5rem;
            font-weight: bold;
            color: #2e7d32;
            margin: 1.5rem 0;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-start {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
        }

        .btn-pause {
            background: linear-gradient(135deg, #ffb74d 0%, #ff9800 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #ef5350 0%, #d32f2f 100%);
            color: white;
        }

        .timer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .timer-settings {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .timer-setting {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .timer-setting label {
            font-size: 0.9rem;
            color: #558b2f;
            font-weight: 500;
        }

        .timer-setting input {
            width: 70px;
            padding: 10px;
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            color: #2e7d32;
            background: white;
        }

        .timer-setting input:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .timer-mode {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #c8e6c9;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #388e3c;
            font-weight: 500;
        }

        .mode-btn.active {
            border-color: #4caf50;
            background: #4caf50;
            color: white;
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.3);
        }

        /* Стили для трекера привычек */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 18px;
            margin-top: 1.5rem;
        }

        .habit-card {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
            transition: all 0.3s;
            border: 1px solid #c8e6c9;
        }

        .habit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15);
        }

        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .habit-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2e7d32;
        }

        .habit-streak {
            background: #fff8e1;
            color: #f57f17;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .habit-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 12px;
        }

        .calendar-day {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .day-completed {
            background: #4caf50;
            color: white;
            box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
        }

        .day-missed {
            background: #ffebee;
            color: #c62828;
        }

        .day-empty {
            background: #f5f5f5;
            color: #9e9e9e;
        }

        /* Стили для целей и проектов */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }

        .goal-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
            border: 1px solid #c8e6c9;
            transition: all 0.3s;
        }

        .goal-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .goal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2e7d32;
        }

        .goal-deadline {
            background: #e3f2fd;
            color: #1565c0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .goal-progress {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: #689f38;
            font-weight: 500;
            margin-top: 5px;
        }

        .goal-subtasks {
            margin-top: 15px;
        }

        .subtask {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .subtask input[type="checkbox"] {
            accent-color: #4caf50;
        }

        /* Стили для дашборда */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
            text-align: center;
            border: 1px solid #c8e6c9;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4caf50;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: #689f38;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
            margin-top: 1.5rem;
            border: 1px solid #c8e6c9;
        }

        /* Стили для синхронизации */
        .sync-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #c8e6c9;
        }

        .sync-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .sync-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Адаптивность для мобильных устройств */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .app {
                border-radius: 15px;
            }
            
            .app-header {
                padding: 1rem;
            }
            
            .app-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .user-section {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            .app-header nav {
                gap: 5px;
            }
            
            .nav-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-width: 70px;
            }
            
            .app-main {
                padding: 1rem;
            }
            
            .module-title {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .add-task-form {
                flex-direction: column;
                padding: 15px;
                gap: 12px;
            }
            
            .task-filters {
                gap: 6px;
            }
            
            .filter-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .task-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 12px;
            }
            
            .task-checkbox {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .task-actions {
                margin-top: 10px;
                align-self: stretch;
                justify-content: flex-end;
            }
            
            .task-btn {
                padding: 8px 14px;
                flex-grow: 1;
            }
            
            .timer-display {
                font-size: 2.8rem;
                margin: 1rem 0;
            }
            
            .timer-controls {
                gap: 8px;
            }
            
            .timer-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }
            
            .timer-settings {
                flex-direction: column;
                gap: 12px;
            }
            
            .timer-setting {
                flex-direction: row;
                justify-content: center;
                gap: 10px;
            }
            
            .timer-setting input {
                width: 60px;
            }
            
            .timer-mode {
                gap: 10px;
            }
            
            .mode-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 2rem;
            }
            
            .habits-grid,
            .goals-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .habit-card,
            .goal-card {
                padding: 15px;
            }
            
            .calendar-day {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            
            .chart-container {
                padding: 15px;
                margin-top: 1rem;
            }
            
            .sync-buttons {
                flex-direction: column;
            }
            
            .sync-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .app-header h1 {
                font-size: 1.3rem;
            }
            
            .nav-btn {
                padding: 7px 10px;
                font-size: 0.75rem;
                min-width: 60px;
            }
            
            .timer-display {
                font-size: 2.2rem;
            }
            
            .timer-btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
            
            .module-title {
                font-size: 1.2rem;
            }
            
            .task-text {
                font-size: 1rem;
            }
            
            .task-meta {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="app-header">
            <h1>Продуктивный менеджер PRO</h1>
            <div class="user-section">
                <div class="user-avatar" id="user-avatar" title="Войти через GitHub">👤</div>
            </div>
            <nav>
                <button class="nav-btn" data-tab="dashboard">Статистика</button>
                <button class="nav-btn" data-tab="tasks">Задачи</button>
                <button class="nav-btn" data-tab="goals">Цели</button>
                <button class="nav-btn" data-tab="timer">Таймер</button>
                <button class="nav-btn" data-tab="habits">Привычки</button>
                <button class="nav-btn" data-tab="sync">Синхронизация</button>
            </nav>
        </header>
        
        <main class="app-main">
            <!-- Дашборд -->
            <div id="dashboard" class="module-container">
                <h2 class="module-title">Общая Статистика</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="current-tasks">0</div>
                        <div class="stat-label">Текущие задачи</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completed-tasks">0</div>
                        <div class="stat-label">Завершено задач</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="productivities">0</div>
                        <div class="stat-label">Продуктивностей</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="habit-streak">0</div>
                        <div class="stat-label">Дней подряд с привычками</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="productivity-chart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>
            
            <!-- Задачи -->
            <div id="tasks" class="module-container" style="display: none;">
                <h2 class="module-title">Мои Задачи</h2>
                <div class="add-task-form">
                    <input type="text" id="new-task-input" placeholder="Добавить новую задачу...">
                    <select id="task-tag">
                        <option value="work">Работа</option>
                        <option value="personal">Личное</option>
                        <option value="health">Здоровье</option>
                        <option value="learning">Обучение</option>
                    </select>
                    <select id="task-priority">
                        <option value="high">Высокий приоритет</option>
                        <option value="medium" selected>Средний приоритет</option>
                        <option value="low">Низкий приоритет</option>
                    </select>
                    <button id="add-task-btn">Добавить</button>
                </div>
                
                <div class="task-filters">
                    <button class="filter-btn active" data-filter="current">Текущие</button>
                    <button class="filter-btn" data-filter="completed">Завершенные</button>
                    <button class="filter-btn" data-filter="all">Все</button>
                </div>
                
                <ul class="task-list" id="task-list"></ul>
            </div>
            
            <!-- Цели и проекты -->
            <div id="goals" class="module-container" style="display: none;">
                <h2 class="module-title">Мои Цели и Проекты</h2>
                <div class="add-task-form">
                    <input type="text" id="new-goal-input" placeholder="Название цели...">
                    <input type="date" id="goal-deadline">
                    <button id="add-goal-btn">Добавить цель</button>
                </div>
                
                <div class="goals-grid" id="goals-container"></div>
            </div>
            
            <!-- Продуктивный таймер -->
            <div id="timer" class="module-container" style="display: none;">
                <h2 class="module-title">Продуктивный таймер</h2>
                <div class="timer-container">
                    <div class="timer-display" id="timer-display">25:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn btn-start" id="start-btn">Старт</button>
                        <button class="timer-btn btn-pause" id="pause-btn">Пауза</button>
                        <button class="timer-btn btn-reset" id="reset-btn">Сброс</button>
                    </div>
                    
                    <div class="timer-settings">
                        <div class="timer-setting">
                            <label for="work-time">Работа (мин)</label>
                            <input type="number" id="work-time" min="1" max="60" value="25">
                        </div>
                        <div class="timer-setting">
                            <label for="break-time">Перерыв (мин)</label>
                            <input type="number" id="break-time" min="1" max="30" value="5">
                        </div>
                    </div>
                    
                    <div class="timer-mode">
                        <button class="mode-btn active" data-mode="work">Работа</button>
                        <button class="mode-btn" data-mode="break">Перерыв</button>
                    </div>
                </div>
            </div>
            
            <!-- Трекер привычек -->
            <div id="habits" class="module-container" style="display: none;">
                <h2 class="module-title">Трекер Привычек</h2>
                <div class="add-task-form">
                    <input type="text" id="new-habit-input" placeholder="Добавить новую привычку...">
                    <button id="add-habit-btn">Добавить</button>
                </div>
                
                <div class="habits-grid" id="habits-container"></div>
            </div>
            
            <!-- Синхронизация -->
            <div id="sync" class="module-container" style="display: none;">
                <h2 class="module-title">Синхронизация и Резервные копии</h2>
                
                <div class="sync-section">
                    <h3>GitHub Синхронизация</h3>
                    <p>Автоматическая синхронизация ваших данных через GitHub Gist</p>
                    <div class="sync-buttons">
                        <button class="sync-btn" id="github-login">Войти через GitHub</button>
                        <button class="sync-btn" id="github-sync">Синхронизировать сейчас</button>
                    </div>
                </div>
                
                <div class="sync-section">
                    <h3>Ручное резервное копирование</h3>
                    <p>Экспортируйте и импортируйте ваши данные вручную</p>
                    <div class="sync-buttons">
                        <button class="sync-btn" id="export-data">Экспорт данных</button>
                        <button class="sync-btn" id="import-data">Импорт данных</button>
                    </div>
                </div>
                
                <div class="sync-section">
                    <h3>Экспорт в календарь</h3>
                    <p>Добавьте ваши задачи и цели в календарь</p>
                    <div class="sync-buttons">
                        <button class="sync-btn" id="export-calendar">Экспорт в .ics</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Главное состояние приложения
        const state = {
            tasks: JSON.parse(localStorage.getItem('productivity-tasks')) || [],
            goals: JSON.parse(localStorage.getItem('goals')) || [],
            productivities: parseInt(localStorage.getItem('productivities')) || 0,
            habits: JSON.parse(localStorage.getItem('habits')) || [],
            currentFilter: 'current',
            timer: {
                mode: 'work',
                workTime: 25,
                breakTime: 5,
                time: 25 * 60,
                isRunning: false,
                interval: null
            },
            user: {
                isLoggedIn: false,
                username: null,
                avatar: null
            }
        };

        // DOM элементы
        const elements = {
            tabs: document.querySelectorAll('.nav-btn'),
            modules: document.querySelectorAll('.module-container'),
            // Задачи
            taskInput: document.getElementById('new-task-input'),
            taskTag: document.getElementById('task-tag'),
            taskPriority: document.getElementById('task-priority'),
            addTaskBtn: document.getElementById('add-task-btn'),
            taskList: document.getElementById('task-list'),
            filterBtns: document.querySelectorAll('.filter-btn'),
            // Цели
            goalInput: document.getElementById('new-goal-input'),
            goalDeadline: document.getElementById('goal-deadline'),
            addGoalBtn: document.getElementById('add-goal-btn'),
            goalsContainer: document.getElementById('goals-container'),
            // Таймер
            timerDisplay: document.getElementById('timer-display'),
            startBtn: document.getElementById('start-btn'),
            pauseBtn: document.getElementById('pause-btn'),
            resetBtn: document.getElementById('reset-btn'),
            modeBtns: document.querySelectorAll('.mode-btn'),
            workTimeInput: document.getElementById('work-time'),
            breakTimeInput: document.getElementById('break-time'),
            // Привычки
            habitInput: document.getElementById('new-habit-input'),
            addHabitBtn: document.getElementById('add-habit-btn'),
            habitsContainer: document.getElementById('habits-container'),
            // Дашборд
            currentTasks: document.getElementById('current-tasks'),
            completedTasks: document.getElementById('completed-tasks'),
            productivities: document.getElementById('productivities'),
            habitStreak: document.getElementById('habit-streak'),
            // Синхронизация
            githubLogin: document.getElementById('github-login'),
            githubSync: document.getElementById('github-sync'),
            exportData: document.getElementById('export-data'),
            importData: document.getElementById('import-data'),
            exportCalendar: document.getElementById('export-calendar'),
            // Пользователь
            userAvatar: document.getElementById('user-avatar')
        };

        // Инициализация приложения
        function initApp() {
            setupEventListeners();
            renderTasks();
            renderGoals();
            updateDashboard();
            renderHabits();
            updateTimerDisplay();
            checkAuthStatus();
            
            // Загрузка настроек таймера
            const savedWorkTime = localStorage.getItem('work-time');
            const savedBreakTime = localStorage.getItem('break-time');
            
            if (savedWorkTime) {
                state.timer.workTime = parseInt(savedWorkTime);
                elements.workTimeInput.value = state.timer.workTime;
            }
            
            if (savedBreakTime) {
                state.timer.breakTime = parseInt(savedBreakTime);
                elements.breakTimeInput.value = state.timer.breakTime;
            }
            
            updateTimerMode();
            
            // Запрос разрешения на уведомления
            if ('Notification' in window) {
                Notification.requestPermission();
            }
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Навигация
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Задачи
            elements.addTaskBtn.addEventListener('click', addTask);
            elements.taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            elements.filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    state.currentFilter = btn.dataset.filter;
                    renderTasks();
                });
            });

            // Цели
            elements.addGoalBtn.addEventListener('click', addGoal);
            elements.goalInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addGoal();
            });

            // Таймер
            elements.startBtn.addEventListener('click', startTimer);
            elements.pauseBtn.addEventListener('click', pauseTimer);
            elements.resetBtn.addEventListener('click', resetTimer);
            
            elements.modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    switchTimerMode(btn.dataset.mode);
                });
            });
            
            elements.workTimeInput.addEventListener('change', updateTimerSettings);
            elements.breakTimeInput.addEventListener('change', updateTimerSettings);

            // Привычки
            elements.addHabitBtn.addEventListener('click', addHabit);
            elements.habitInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addHabit();
            });

            // Синхронизация
            elements.githubLogin.addEventListener('click', githubLogin);
            elements.githubSync.addEventListener('click', githubSync);
            elements.exportData.addEventListener('click', exportData);
            elements.importData.addEventListener('click', importData);
            elements.exportCalendar.addEventListener('click', exportToCalendar);

            // Пользователь
            elements.userAvatar.addEventListener('click', handleUserClick);
        }

        // Проверка статуса авторизации
        function checkAuthStatus() {
            const token = localStorage.getItem('github_token');
            const userData = localStorage.getItem('github_user');
            
            if (token && userData) {
                state.user.isLoggedIn = true;
                state.user = { ...state.user, ...JSON.parse(userData) };
                updateUserUI();
            }
        }

        // Обновление UI пользователя
        function updateUserUI() {
            if (state.user.isLoggedIn) {
                elements.userAvatar.textContent = state.user.avatar || '👤';
                elements.userAvatar.title = state.user.username || 'Пользователь';
            } else {
                elements.userAvatar.textContent = '👤';
                elements.userAvatar.title = 'Войти через GitHub';
            }
        }

        // Обработчик клика по аватару
        function handleUserClick() {
            if (state.user.isLoggedIn) {
                if (confirm('Выйти из аккаунта?')) {
                    logout();
                }
            } else {
                githubLogin();
            }
        }

        // Выход из аккаунта
        function logout() {
            localStorage.removeItem('github_token');
            localStorage.removeItem('github_user');
            state.user = { isLoggedIn: false, username: null, avatar: null };
            updateUserUI();
            showNotification('Вы вышли из аккаунта');
        }

        // GitHub авторизация
        function githubLogin() {
            // В реальном приложении здесь был бы OAuth flow
            const username = prompt('Введите ваше имя пользователя GitHub:');
            if (username) {
                state.user = {
                    isLoggedIn: true,
                    username: username,
                    avatar: '🚀'
                };
                localStorage.setItem('github_user', JSON.stringify(state.user));
                updateUserUI();
                showNotification(`Добро пожаловать, ${username}!`);
            }
        }

        // Синхронизация с GitHub
        function githubSync() {
            if (!state.user.isLoggedIn) {
                alert('Сначала войдите через GitHub');
                return;
            }
            
            showNotification('Синхронизация с GitHub...');
            // Имитация синхронизации
            setTimeout(() => {
                showNotification('Данные синхронизированы!');
            }, 1500);
        }

        // Экспорт данных
        function exportData() {
            const data = {
                tasks: state.tasks,
                goals: state.goals,
                habits: state.habits,
                productivities: state.productivities,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `productivity-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Данные экспортированы!');
        }

        // Импорт данных
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm('Заменить текущие данные импортированными?')) {
                            state.tasks = data.tasks || [];
                            state.goals = data.goals || [];
                            state.habits = data.habits || [];
                            state.productivities = data.productivities || 0;
                            
                            saveAllData();
                            renderTasks();
                            renderGoals();
                            renderHabits();
                            updateDashboard();
                            
                            showNotification('Данные импортированы!');
                        }
                    } catch (error) {
                        alert('Ошибка при импорте данных: неверный формат файла');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Экспорт в календарь
        function exportToCalendar() {
            // Генерация .ics файла
            let icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Productivity Manager//EN',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH'
            ];

            // Добавляем задачи с дедлайнами
            state.tasks.forEach(task => {
                if (!task.completed) {
                    icsContent.push(
                        'BEGIN:VEVENT',
                        `SUMMARY:${task.text}`,
                        `DTSTART:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z`,
                        `DTEND:${new Date(Date.now() + 3600000).toISOString().replace(/[-:]/g, '').split('.')[0]}Z`,
                        `DESCRIPTION:Приоритет: ${task.priority}, Категория: ${task.tag}`,
                        'PRIORITY:5',
                        'END:VEVENT'
                    );
                }
            });

            // Добавляем цели с дедлайнами
            state.goals.forEach(goal => {
                if (goal.deadline && !goal.completed) {
                    icsContent.push(
                        'BEGIN:VEVENT',
                        `SUMMARY:Цель: ${goal.title}`,
                        `DTSTART:${goal.deadline}T090000Z`,
                        `DTEND:${goal.deadline}T100000Z`,
                        `DESCRIPTION:Прогресс: ${goal.progress}%`,
                        'PRIORITY:3',
                        'END:VEVENT'
                    );
                }
            });

            icsContent.push('END:VCALENDAR');

            const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'productivity-calendar.ics';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Календарь экспортирован!');
        }

        // Показать уведомление
        function showNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Продуктивный менеджер', { 
                    body: message, 
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTIiIGZpbGw9IiM0Y2FmNTAiLz4KPHBhdGggZD0iTTMyIDE2TDI0IDI4TDI4IDMyTDM2IDI0TDQ0IDMyTDQ4IDI4TDQwIDE2SDMyWiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTI0IDQwTDMwIDQ2TDM2IDQwTDQyIDQ2TDQ4IDQwTDM2IDI4TDI0IDQwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+'
                });
            }
            
            // Также показываем toast сообщение
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #4caf50;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }

        // Сохранение всех данных
        function saveAllData() {
            localStorage.setItem('productivity-tasks', JSON.stringify(state.tasks));
            localStorage.setItem('goals', JSON.stringify(state.goals));
            localStorage.setItem('habits', JSON.stringify(state.habits));
            localStorage.setItem('productivities', state.productivities.toString());
        }

        // Переключение вкладок
        function switchTab(tabName) {
            elements.tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            elements.modules.forEach(module => {
                module.style.display = module.id === tabName ? 'block' : 'none';
            });
            
            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }

        // Функции для работы с задачами
        function addTask() {
            const text = elements.taskInput.value.trim();
            if (!text) return;
            
            const newTask = {
                id: Date.now(),
                text: text,
                completed: false,
                tag: elements.taskTag.value,
                priority: elements.taskPriority.value,
                date: new Date().toISOString(),
                comments: []
            };
            
            state.tasks.push(newTask);
            saveAllData();
            elements.taskInput.value = '';
            renderTasks();
            updateDashboard();
            
            showNotification('Задача добавлена!');
        }

        function toggleTaskCompletion(id) {
            const task = state.tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveAllData();
                renderTasks();
                updateDashboard();
                
                if (task.completed) {
                    showNotification(`Задача "${task.text}" завершена! 🎉`);
                }
            }
        }

        function deleteTask(id) {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveAllData();
            renderTasks();
            updateDashboard();
        }

        function renderTasks() {
            let filteredTasks = state.tasks;
            
            if (state.currentFilter === 'current') {
                filteredTasks = state.tasks.filter(t => !t.completed);
            } else if (state.currentFilter === 'completed') {
                filteredTasks = state.tasks.filter(t => t.completed);
            }
            
            elements.taskList.innerHTML = '';
            
            filteredTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `task-item ${task.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                    <div class="task-content">
                        <div class="task-text">${task.text}</div>
                        <div class="task-meta">
                            <span class="task-tag tag-${task.tag}">${getTagName(task.tag)}</span>
                            <span class="task-priority priority-${task.priority}">${getPriorityName(task.priority)}</span>
                        </div>
                        ${task.comments && task.comments.length > 0 ? `
                            <div class="task-comments">
                                ${task.comments.map(comment => `
                                    <div class="comment">💬 ${comment}</div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="task-actions">
                        <button class="task-btn btn-comment">💬</button>
                        <button class="task-btn btn-delete">🗑️</button>
                    </div>
                `;
                
                li.querySelector('.task-checkbox').addEventListener('change', () => toggleTaskCompletion(task.id));
                li.querySelector('.btn-delete').addEventListener('click', () => deleteTask(task.id));
                li.querySelector('.btn-comment').addEventListener('click', () => {
                    const comment = prompt('Добавить комментарий к задаче:');
                    if (comment) {
                        if (!task.comments) task.comments = [];
                        task.comments.push(comment);
                        saveAllData();
                        renderTasks();
                    }
                });
                
                elements.taskList.appendChild(li);
            });
        }

        function getTagName(tag) {
            const tags = {
                work: 'Работа',
                personal: 'Личное',
                health: 'Здоровье',
                learning: 'Обучение'
            };
            return tags[tag] || tag;
        }

        function getPriorityName(priority) {
            const priorities = {
                high: 'Высокий',
                medium: 'Средний',
                low: 'Низкий'
            };
            return priorities[priority] || priority;
        }

        // Функции для работы с целями
        function addGoal() {
            const title = elements.goalInput.value.trim();
            const deadline = elements.goalDeadline.value;
            
            if (!title) return;
            
            const newGoal = {
                id: Date.now(),
                title: title,
                deadline: deadline,
                completed: false,
                progress: 0,
                subtasks: [],
                createdAt: new Date().toISOString()
            };
            
            state.goals.push(newGoal);
            saveAllData();
            elements.goalInput.value = '';
            elements.goalDeadline.value = '';
            renderGoals();
            
            showNotification('Цель добавлена!');
        }

        function toggleGoalCompletion(id) {
            const goal = state.goals.find(g => g.id === id);
            if (goal) {
                goal.completed = !goal.completed;
                saveAllData();
                renderGoals();
                updateDashboard();
            }
        }

        function deleteGoal(id) {
            state.goals = state.goals.filter(g => g.id !== id);
            saveAllData();
            renderGoals();
        }

        function addSubtask(goalId) {
            const text = prompt('Добавить подзадачу:');
            if (text) {
                const goal = state.goals.find(g => g.id === goalId);
                if (goal) {
                    if (!goal.subtasks) goal.subtasks = [];
                    goal.subtasks.push({
                        id: Date.now(),
                        text: text,
                        completed: false
                    });
                    updateGoalProgress(goal);
                    saveAllData();
                    renderGoals();
                }
            }
        }

        function toggleSubtask(goalId, subtaskId) {
            const goal = state.goals.find(g => g.id === goalId);
            if (goal && goal.subtasks) {
                const subtask = goal.subtasks.find(s => s.id === subtaskId);
                if (subtask) {
                    subtask.completed = !subtask.completed;
                    updateGoalProgress(goal);
                    saveAllData();
                    renderGoals();
                }
            }
        }

        function updateGoalProgress(goal) {
            if (!goal.subtasks || goal.subtasks.length === 0) {
                goal.progress = goal.completed ? 100 : 0;
                return;
            }
            
            const completed = goal.subtasks.filter(s => s.completed).length;
            goal.progress = Math.round((completed / goal.subtasks.length) * 100);
            
            if (goal.progress === 100) {
                goal.completed = true;
                showNotification(`Цель "${goal.title}" достигнута! 🎊`);
            }
        }

        function renderGoals() {
            elements.goalsContainer.innerHTML = '';
            
            state.goals.forEach(goal => {
                const goalCard = document.createElement('div');
                goalCard.className = `goal-card ${goal.completed ? 'completed' : ''}`;
                
                goalCard.innerHTML = `
                    <div class="goal-header">
                        <h3 class="goal-title">${goal.title}</h3>
                        ${goal.deadline ? `
                            <span class="goal-deadline">📅 ${new Date(goal.deadline).toLocaleDateString()}</span>
                        ` : ''}
                    </div>
                    
                    <div class="goal-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${goal.progress}%"></div>
                        </div>
                        <div class="progress-text">${goal.progress}% завершено</div>
                    </div>
                    
                    ${goal.subtasks && goal.subtasks.length > 0 ? `
                        <div class="goal-subtasks">
                            ${goal.subtasks.map(subtask => `
                                <div class="subtask">
                                    <input type="checkbox" ${subtask.completed ? 'checked' : ''}>
                                    <span>${subtask.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="task-actions">
                        <button class="task-btn btn-comment">➕ Подзадача</button>
                        <button class="task-btn btn-delete">🗑️ Удалить</button>
                    </div>
                `;
                
                // Обработчики для чекбоксов подзадач
                if (goal.subtasks) {
                    goal.subtasks.forEach((subtask, index) => {
                        const checkbox = goalCard.querySelectorAll('.subtask input')[index];
                        checkbox.addEventListener('change', () => toggleSubtask(goal.id, subtask.id));
                    });
                }
                
                // Обработчики для кнопок
                goalCard.querySelector('.btn-comment').addEventListener('click', () => addSubtask(goal.id));
                goalCard.querySelector('.btn-delete').addEventListener('click', () => deleteGoal(goal.id));
                
                elements.goalsContainer.appendChild(goalCard);
            });
        }

        // Функции для Продуктивного таймера
        function startTimer() {
            if (state.timer.isRunning) return;
            
            state.timer.isRunning = true;
            state.timer.interval = setInterval(() => {
                if (state.timer.time > 0) {
                    state.timer.time--;
                    updateTimerDisplay();
                } else {
                    clearInterval(state.timer.interval);
                    state.timer.isRunning = false;
                    
                    // Уведомление о завершении
                    if (state.timer.mode === 'work') {
                        state.productivities++;
                        localStorage.setItem('productivities', state.productivities);
                        showNotification('Продуктивность завершена! 🎯 Время для перерыва.');
                        switchTimerMode('break');
                    } else {
                        showNotification('Перерыв завершен! ⏰ Время работать.');
                        switchTimerMode('work');
                    }
                    
                    updateDashboard();
                    startTimer();
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(state.timer.interval);
            state.timer.isRunning = false;
        }

        function resetTimer() {
            pauseTimer();
            updateTimerMode();
        }

        function switchTimerMode(mode) {
            state.timer.mode = mode;
            updateTimerMode();
        }

        function updateTimerMode() {
            const time = state.timer.mode === 'work' 
                ? state.timer.workTime * 60 
                : state.timer.breakTime * 60;
            
            state.timer.time = time;
            updateTimerDisplay();
            
            // Обновляем активную кнопку режима
            elements.modeBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === state.timer.mode);
            });
        }

        function updateTimerSettings() {
            state.timer.workTime = parseInt(elements.workTimeInput.value) || 25;
            state.timer.breakTime = parseInt(elements.breakTimeInput.value) || 5;
            
            // Сохраняем настройки
            localStorage.setItem('work-time', state.timer.workTime);
            localStorage.setItem('break-time', state.timer.breakTime);
            
            // Обновляем таймер, если он не запущен
            if (!state.timer.isRunning) {
                updateTimerMode();
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(state.timer.time / 60);
            const seconds = state.timer.time % 60;
            elements.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Функции для трекера привычек
        function addHabit() {
            const text = elements.habitInput.value.trim();
            if (!text) return;
            
            const newHabit = {
                id: Date.now(),
                title: text,
                completedDates: [],
                streak: 0,
                createdAt: new Date().toISOString()
            };
            
            state.habits.push(newHabit);
            saveAllData();
            elements.habitInput.value = '';
            renderHabits();
            updateDashboard();
            
            showNotification('Привычка добавлена!');
        }

        function toggleHabitDate(habitId, dateStr) {
            const habit = state.habits.find(h => h.id === habitId);
            if (!habit) return;
            
            const dateIndex = habit.completedDates.indexOf(dateStr);
            
            if (dateIndex === -1) {
                habit.completedDates.push(dateStr);
            } else {
                habit.completedDates.splice(dateIndex, 1);
            }
            
            // Обновляем streak
            updateHabitStreak(habit);
            
            saveAllData();
            renderHabits();
            updateDashboard();
        }

        function updateHabitStreak(habit) {
            const sortedDates = habit.completedDates.sort().reverse();
            let streak = 0;
            let currentDate = new Date();
            
            for (let i = 0; i < sortedDates.length; i++) {
                const habitDate = new Date(sortedDates[i]);
                const diffTime = Math.abs(currentDate - habitDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === streak + 1) {
                    streak++;
                } else {
                    break;
                }
            }
            
            habit.streak = streak;
            
            if (streak > 0 && streak % 7 === 0) {
                showNotification(`Отличная работа! 🔥 ${streak} дней подряд с привычкой "${habit.title}"`);
            }
        }

        function deleteHabit(id) {
            state.habits = state.habits.filter(h => h.id !== id);
            saveAllData();
            renderHabits();
            updateDashboard();
        }

        function renderHabits() {
            elements.habitsContainer.innerHTML = '';
            
            state.habits.forEach(habit => {
                const habitCard = document.createElement('div');
                habitCard.className = 'habit-card';
                
                // Генерируем последние 7 дней
                const last7Days = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    last7Days.push(date.toISOString().split('T')[0]);
                }
                
                habitCard.innerHTML = `
                    <div class="habit-header">
                        <h3 class="habit-title">${habit.title}</h3>
                        <span class="habit-streak">🔥 ${habit.streak} дней</span>
                    </div>
                    <div class="habit-calendar">
                        ${last7Days.map(date => {
                            const isCompleted = habit.completedDates.includes(date);
                            const isToday = date === new Date().toISOString().split('T')[0];
                            const day = new Date(date).getDate();
                            
                            return `
                                <div class="calendar-day ${isCompleted ? 'day-completed' : isToday ? 'day-empty' : 'day-missed'}" 
                                     data-date="${date}">
                                    ${day}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <button class="task-btn btn-delete" style="margin-top: 15px;">🗑️ Удалить</button>
                `;
                
                // Добавляем обработчики для дней календаря
                habitCard.querySelectorAll('.calendar-day').forEach(day => {
                    day.addEventListener('click', () => {
                        toggleHabitDate(habit.id, day.dataset.date);
                    });
                });
                
                // Обработчик для удаления привычки
                habitCard.querySelector('.btn-delete').addEventListener('click', () => {
                    deleteHabit(habit.id);
                });
                
                elements.habitsContainer.appendChild(habitCard);
            });
        }

        // Функции для дашборда
        function updateDashboard() {
            // Обновляем цифры
            elements.currentTasks.textContent = state.tasks.filter(t => !t.completed).length;
            elements.completedTasks.textContent = state.tasks.filter(t => t.completed).length;
            elements.productivities.textContent = state.productivities;
            
            // Считаем максимальный streak среди привычек
            const maxStreak = state.habits.length > 0 
                ? Math.max(...state.habits.map(h => h.streak)) 
                : 0;
            elements.habitStreak.textContent = maxStreak;
            
            // Обновляем графики
            updateCharts();
        }

        function updateCharts() {
            updateProductivityChart();
            updateWeeklyChart();
        }

        function updateProductivityChart() {
            const ctx = document.getElementById('productivity-chart').getContext('2d');
            
            // Группируем задачи по тегам
            const tags = {};
            state.tasks.forEach(task => {
                if (!tags[task.tag]) tags[task.tag] = 0;
                if (task.completed) tags[task.tag]++;
            });
            
            if (window.productivityChart) {
                window.productivityChart.destroy();
            }
            
            window.productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(tags).map(getTagName),
                    datasets: [{
                        label: 'Выполненные задачи',
                        data: Object.values(tags),
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.7)',
                            'rgba(56, 142, 60, 0.7)',
                            'rgba(104, 159, 56, 0.7)',
                            'rgba(46, 125, 50, 0.7)'
                        ],
                        borderColor: [
                            'rgba(76, 175, 80, 1)',
                            'rgba(56, 142, 60, 1)',
                            'rgba(104, 159, 56, 1)',
                            'rgba(46, 125, 50, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Выполненные задачи по категориям',
                            color: '#2e7d32',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#558b2f'
                            },
                            grid: {
                                color: 'rgba(200, 230, 201, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#558b2f'
                            },
                            grid: {
                                color: 'rgba(200, 230, 201, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        function updateWeeklyChart() {
            const ctx = document.getElementById('weekly-chart').getContext('2d');
            
            // Статистика по дням недели
            const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            const completedByDay = [0, 0, 0, 0, 0, 0, 0];
            
            state.tasks.forEach(task => {
                if (task.completed && task.date) {
                    const day = new Date(task.date).getDay();
                    // Воскресенье = 0, понедельник = 1, etc.
                    const adjustedDay = day === 0 ? 6 : day - 1;
                    completedByDay[adjustedDay]++;
                }
            });
            
            if (window.weeklyChart) {
                window.weeklyChart.destroy();
            }
            
            window.weeklyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Завершенные задачи по дням',
                        data: completedByDay,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Продуктивность по дням недели',
                            color: '#2e7d32',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#558b2f'
                            },
                            grid: {
                                color: 'rgba(200, 230, 201, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#558b2f'
                            },
                            grid: {
                                color: 'rgba(200, 230, 201, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
